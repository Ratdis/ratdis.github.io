<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="ratdis,ratdis1@gmail.com"><title>ç”¨Pythonå†™ä¸ªå°Bot Â· å¢¨æŸ“çš„æ¨±èŠ±ğŸŒ¸</title><meta name="description" content="å†™åœ¨å‰é¢æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ç”¨Pythonç©ä¸‹Telegramä¸­çš„Botå§
å®ç°ä¸€ä¸ªå®æ—¶æŸ¥è¯¢æœåŠ¡å™¨CPUåˆ©ç”¨ç‡çš„Bot

Wikipedia:
Telegramæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å³æ—¶é€šä¿¡è½¯ä»¶ï¼Œå®ƒçš„å®¢æˆ·ç«¯æ˜¯è‡ªç”±åŠå¼€æ”¾æºä»£ç è½¯ä»¶ï¼Œä½†æ˜¯å®ƒçš„æœåŠ¡å™¨æ˜¯ä¸“æœ‰è½¯ä»¶ã€‚ç”¨æˆ·å¯ä»¥ç›¸äº’äº¤æ¢åŠ å¯†ä¸è‡ªææ„çš„æ¶ˆæ¯"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title><a href="/">å¢¨æŸ“çš„æ¨±èŠ±ğŸŒ¸</a></h3><div class="description"><p>æˆå°±ä»Šæ—¥ å¯è¿ªæœªæ¥</p></div></div></div><ul class="social-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>ç”¨Pythonå†™ä¸ªå°Bot</a></h3></div><div class="post-content"><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ç”¨Pythonç©ä¸‹Telegramä¸­çš„Botå§</p>
<p>å®ç°ä¸€ä¸ªå®æ—¶æŸ¥è¯¢æœåŠ¡å™¨CPUåˆ©ç”¨ç‡çš„Bot</p>
<blockquote>
<p>Wikipedia:</p>
<p><strong>Telegram</strong>æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å³æ—¶é€šä¿¡è½¯ä»¶ï¼Œå®ƒçš„å®¢æˆ·ç«¯æ˜¯è‡ªç”±åŠå¼€æ”¾æºä»£ç è½¯ä»¶ï¼Œä½†æ˜¯å®ƒçš„æœåŠ¡å™¨æ˜¯ä¸“æœ‰è½¯ä»¶ã€‚ç”¨æˆ·å¯ä»¥ç›¸äº’äº¤æ¢åŠ å¯†ä¸è‡ªææ„çš„æ¶ˆæ¯ï¼Œå‘é€ç…§ç‰‡ã€å½±ç‰‡ç­‰æ‰€æœ‰ç±»å‹æ–‡ä»¶ã€‚å®˜æ–¹æä¾›æ‰‹æœºç‰ˆï¼ˆAndroidã€iOSã€Windows Phoneï¼‰ã€æ¡Œé¢ç‰ˆï¼ˆWindowsã€macOSã€Linuxï¼‰å’Œç½‘é¡µç‰ˆç­‰å¤šç§å¹³å°å®¢æˆ·ç«¯ï¼›åŒæ—¶å®˜æ–¹å¼€æ”¾åº”ç”¨ç¨‹åºæ¥å£ï¼Œå› æ­¤æ‹¥æœ‰è®¸å¤šç¬¬ä¸‰æ–¹çš„å®¢æˆ·ç«¯å¯ä¾›é€‰æ‹©ï¼Œå…¶ä¸­å¤šæ¬¾å†…ç½®ä¸­æ–‡ã€‚</p>
</blockquote>
<p>Ratdisçš„ä¸»åŠ›å³æ—¶é€šè®¯è½¯ä»¶ï¼Œä¸ªäººçè¯´é¢‘é“ : <a href="https://t.me/xia_shuo" target="_blank" rel="noopener">é“¾æ¥</a></p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä½¿ç”¨<code>Python3</code></p>
<h2 id="å¼€å‘ç¯å¢ƒæ­å»º"><a href="#å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="å¼€å‘ç¯å¢ƒæ­å»º"></a>å¼€å‘ç¯å¢ƒæ­å»º</h2><h3 id="ä½¿ç”¨virtual-environment"><a href="#ä½¿ç”¨virtual-environment" class="headerlink" title="ä½¿ç”¨virtual environment"></a>ä½¿ç”¨virtual environment</h3><p>é¡¹ç›®ä½¿ç”¨virtual environmentå¯æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™ç©æ„å‘¢</p>
<p>ä½ å¯ä»¥ç®€å•çš„è®¤ä¸º<code>virtual environment</code>æ˜¯ä¸€ä¸ªæ²¡æœ‰å®‰è£…ä»»ä½•ç¬¬ä¸‰æ–¹åº“çš„<code>Python</code>ç¯å¢ƒï¼Œå½“æˆ‘ä»¬å†™å®Œä¸€ä¸ªé¡¹ç›®æ‰“ç®—åˆ†äº«ç»™å…¶ä»–äººçš„æ—¶å€™å°±éœ€è¦å‘Šè¯‰ä»–è¿™ä¸ªé¡¹ç›®ç”¨äº†é‚£äº›ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚æœä½¿ç”¨äº†<code>virtual environment</code>å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰¾å…¨æ‰€æœ‰ä½¿ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“äº†ï¼ˆå¯¼å‡ºæ–¹æ³•è§ä¸‹æ–‡ï¼‰</p>
<h4 id="æœ¬åœ°ä½¿ç”¨"><a href="#æœ¬åœ°ä½¿ç”¨" class="headerlink" title="æœ¬åœ°ä½¿ç”¨"></a>æœ¬åœ°ä½¿ç”¨</h4><p>åœ¨Pycharmä¸­åˆ›å»ºé¡¹ç›®æ—¶å€™é»˜è®¤å°±æ˜¯ä½¿ç”¨çš„virtual environmentäº†</p>
<p>ä¸ç”¨Pycharmçš„è¯ï¼Œ(Linux&amp;Mac)æ“ä½œå’ŒæœåŠ¡å™¨ç«¯æ˜¯ä¸€æ ·çš„</p>
<h4 id="æœåŠ¡å™¨ç«¯ä½¿ç”¨"><a href="#æœåŠ¡å™¨ç«¯ä½¿ç”¨" class="headerlink" title="æœåŠ¡å™¨ç«¯ä½¿ç”¨"></a>æœåŠ¡å™¨ç«¯ä½¿ç”¨</h4><p>å…ˆä½¿ç”¨pipå®‰è£…å¥½virtualenv</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install virtualenv</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰å®‰è£…pipçš„ï¼Œå…ˆå®‰è£…pip</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-pip</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä½ å°†è¦ä½¿ç”¨åˆ°çš„é¡¹ç›®æ–‡ä»¶å¤¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir TGbot</span><br><span class="line">cd TGbot</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªåä¸º<code>venv</code>çš„pythonè¿è¡Œç¯å¢ƒ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv --no-site-packages venv</span><br></pre></td></tr></table></figure>
<p>æ¥ç€ä½¿ç”¨<code>source</code>è¿›å…¥<code>venv</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source venv/bin/activate</span><br></pre></td></tr></table></figure>
<p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œå‘½ä»¤æç¤ºç¬¦æœ€å‰é¢ä¼šå¤šä¸€ä¸ª(venv)</p>
<h4 id="å¯¼å‡ºé¡¹ç›®æ¨¡å—ä¾èµ–ä»¥åŠå®‰è£…"><a href="#å¯¼å‡ºé¡¹ç›®æ¨¡å—ä¾èµ–ä»¥åŠå®‰è£…" class="headerlink" title="å¯¼å‡ºé¡¹ç›®æ¨¡å—ä¾èµ–ä»¥åŠå®‰è£…"></a>å¯¼å‡ºé¡¹ç›®æ¨¡å—ä¾èµ–ä»¥åŠå®‰è£…</h4><p>å½“ä½ å†™å¥½ä¸€ä¸ªé¡¹ç›®æ‰“ç®—ç»™ä»–äººä½¿ç”¨æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†é¡¹ç›®æ‰€ç”¨åˆ°çš„æ‰€æœ‰æ¨¡å—ä¾èµ–å¯¼å‡ºåˆ°requirements.txt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åˆ«äººå°±å¯ä»¥ç›´æ¥è¿™æ ·å®‰è£…ä½¿ç”¨å•¦</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…å¥½å°†è¦ä½¿ç”¨åˆ°çš„æ¨¡å—"><a href="#å®‰è£…å¥½å°†è¦ä½¿ç”¨åˆ°çš„æ¨¡å—" class="headerlink" title="å®‰è£…å¥½å°†è¦ä½¿ç”¨åˆ°çš„æ¨¡å—"></a>å®‰è£…å¥½å°†è¦ä½¿ç”¨åˆ°çš„æ¨¡å—</h3><p>åœ¨Pycharmä¸­ Preferencesæœç´¢interpreteråï¼Œç‚¹åŠ å·æœç´¢æ¨¡å—åç§°å³å¯å®‰è£…</p>
<p><img src="https://www.ratdis1.com/usr/uploads/2019/01/3127646363.png" alt="Screen Shot 2019-01-12 at 2.48.35 PM-min.png"></p>
<p>æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„æ¨¡å—æœ‰ <code>python-telegram-bot</code>(Telegram API)ï¼Œ<code>ruamel.yaml</code>(å¤„ç†yamlé…ç½®æ–‡ä»¶çš„)ï¼Œ<code>psutil</code>ï¼ˆè·¨å¹³å°è·å–ç³»ç»Ÿä¿¡æ¯ï¼‰</p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨å®‰è£…æ‰€æœ‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install python-telegram-bot psutil ruamel.yaml</span><br></pre></td></tr></table></figure>
<h2 id="Telegramä¸­çš„Botä»‹ç»"><a href="#Telegramä¸­çš„Botä»‹ç»" class="headerlink" title="Telegramä¸­çš„Botä»‹ç»"></a>Telegramä¸­çš„Botä»‹ç»</h2><blockquote>
<h3 id="How-are-bots-different-from-humans"><a href="#How-are-bots-different-from-humans" class="headerlink" title="How are bots different from humans?"></a>How are bots different from humans?</h3><ul>
<li>Bots have no online status and no last seen timestamps, the interface shows the label <strong>â€˜botâ€™</strong> instead.</li>
<li>Bots have limited cloud storage â€” older messages may be removed by the server shortly after they have been processed.</li>
<li>Bots canâ€™t initiate conversations with users. A user <strong>must</strong> either add them to a group or send them a message first. People can use <code>telegram.me/&lt;bot_username&gt;</code> links or username search to find your bot.</li>
<li>Bot usernames always end in â€˜botâ€™ (e.g. <a href="https://telegram.me/triviabot" target="_blank" rel="noopener">@TriviaBot</a>, <a href="https://telegram.me/githubbot" target="_blank" rel="noopener">@GitHub_bot</a>).</li>
<li>When added to a group, bots do not receive all messages by default (see <a href="https://core.telegram.org/bots#privacy-mode" target="_blank" rel="noopener">Privacy mode</a>).</li>
<li><strong>Bots never eat, sleep or complain (unless expressly programmed otherwise).</strong></li>
</ul>
</blockquote>
<p>æ€»ä¹‹botä¸çœŸäººæœ€å¤§å·®è·å°±æ˜¯æ²¡æœ‰åœ¨çº¿çŠ¶æ€ï¼Œä¸èƒ½ä¸»åŠ¨èŠå¤©åŠ ç¾¤ä»¥åŠåå­—ç»“å°¾å¿…é¡»ä¸ºbotï¼ŒçœŸäººèƒ½åšçš„å‡ ä¹éƒ½èƒ½åšï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œå…·ä½“è¿˜æ˜¯è§<a href="https://core.telegram.org/bots" target="_blank" rel="noopener">å®˜æ–¹ä»‹ç»</a>å§</p>
<h2 id="å’ŒBotfatherç­¾è®¢å¥‘çº¦æˆä¸ºé©¬çŒ´çƒ§é…’Botå§ï¼ˆä¸"><a href="#å’ŒBotfatherç­¾è®¢å¥‘çº¦æˆä¸ºé©¬çŒ´çƒ§é…’Botå§ï¼ˆä¸" class="headerlink" title="å’ŒBotfatherç­¾è®¢å¥‘çº¦æˆä¸ºé©¬çŒ´çƒ§é…’Botå§ï¼ˆä¸"></a>å’ŒBotfatherç­¾è®¢å¥‘çº¦æˆä¸ºé©¬çŒ´çƒ§é…’Botå§ï¼ˆä¸</h2><blockquote>
<h3 id="How-do-I-create-a-bot"><a href="#How-do-I-create-a-bot" class="headerlink" title="How do I create a bot?"></a>How do I create a bot?</h3><p>Thereâ€™s aâ€¦ bot for that. Just talk to <a href="https://telegram.me/botfather" target="_blank" rel="noopener">BotFather</a> (described <a href="https://core.telegram.org/bots#6-botfather" target="_blank" rel="noopener">below</a>) and follow a few simple steps. Once youâ€™ve created a bot and received your authorization token, head down to the <a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener">Bot API manual</a> to see what you can teach your bot to do.</p>
</blockquote>
<p><del>å°±çŸ¥é“è´´å®˜ç½‘ä»‹ç»ï¼Œè¦ä½ ä½•ç”¨</del></p>
<p>è·Ÿç€<a href="https://telegram.me/botfather" target="_blank" rel="noopener">BotFather</a>ä¸€é¡¿æ“ä½œå°±å®Œäº‹äº†</p>
<p>æ³¨æ„ä¸è¦æ³„æ¼token</p>
<h2 id="å¼€å§‹å§ï¼"><a href="#å¼€å§‹å§ï¼" class="headerlink" title="å¼€å§‹å§ï¼"></a>å¼€å§‹å§ï¼</h2><h3 id="ä½¿ç”¨yamlå¤„ç†ç±»ä¼¼äºTOKENçš„ä¸ªäººé…ç½®"><a href="#ä½¿ç”¨yamlå¤„ç†ç±»ä¼¼äºTOKENçš„ä¸ªäººé…ç½®" class="headerlink" title="ä½¿ç”¨yamlå¤„ç†ç±»ä¼¼äºTOKENçš„ä¸ªäººé…ç½®"></a>ä½¿ç”¨yamlå¤„ç†ç±»ä¼¼äºTOKENçš„ä¸ªäººé…ç½®</h3><p>å¦‚æœæƒ³è®©ä»£ç èƒ½å¤Ÿå¾ˆå¿«çš„ä¸ºä»–äººæ‰€ç”¨ï¼Œåœ¨é…ç½®æ–¹é¢å°±åº”è¯¥å•ç‹¬çš„è®¾ç«‹ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥æ˜¯<code>yaml</code>ä¹Ÿå¯ä»¥æ˜¯<code>json</code>ï¼Œè¿™ä¸¤ç§é…ç½®æ–‡ä»¶åœ¨<code>Python</code>ä¸­éƒ½æœ‰å¾ˆå¥½ç”¨çš„æ¨¡å—ï¼Œè¿™é‡Œæˆ‘ä»¬å°±æ¥ä½¿ç”¨<code>yaml</code>ä½œä¸ºé…ç½®æ–‡ä»¶æ ¼å¼å§<del>ï¼ˆ<code>json</code>ä¸­èŠ±æ‹¬å·å¤ªå¤šï¼Œçœ‹ç€éš¾å—</del></p>
<p>ç”±äºRatdisä¹Ÿæ˜¯é¦–æ¬¡ç”¨åˆ°<code>yaml</code>ï¼Œä¸Š<a href="https://yaml.org/" target="_blank" rel="noopener">å®˜ç½‘</a>æ‰¾åˆ°Pythonçš„æ¨¡å—ï¼Œé€‰äº†ä¸ªæ”¯æŒæœ€æ–°<code>yaml</code>1.2çš„<a href="https://pypi.org/project/ruamel.yaml/" target="_blank" rel="noopener">ruamel.ymal</a>ç”¨ç€äº†</p>
<blockquote>
<h1 id="ruamel-yaml-Examples"><a href="#ruamel-yaml-Examples" class="headerlink" title="ruamel.yaml Examples"></a>ruamel.yaml Examples</h1><p>Basic round trip of parsing YAML to Python objects, modifying and generating YAML:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">import</span> sys</span><br><span class="line">&gt; <span class="keyword">from</span> ruamel.yaml <span class="keyword">import</span> YAML</span><br><span class="line">&gt; </span><br><span class="line">&gt; inp = <span class="string">"""\</span></span><br><span class="line"><span class="string">&gt; # example</span></span><br><span class="line"><span class="string">&gt; name:</span></span><br><span class="line"><span class="string">&gt; # details</span></span><br><span class="line"><span class="string">&gt; family: Smith   # very common</span></span><br><span class="line"><span class="string">&gt; given: Alice    # one of the siblings</span></span><br><span class="line"><span class="string">&gt; """</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; yaml = YAML()</span><br><span class="line">&gt; code = yaml.load(inp)</span><br><span class="line">&gt; code[<span class="string">'name'</span>][<span class="string">'given'</span>] = <span class="string">'Bob'</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; yaml.dump(code, sys.stdout)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>Resulting in:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&gt; # example</span></span><br><span class="line"><span class="string">&gt; name:</span></span><br><span class="line"><span class="string">&gt; # details</span></span><br><span class="line"><span class="string">&gt; family: Smith   # very common</span></span><br><span class="line"><span class="string">&gt; given: Bob      # one of the siblings</span></span><br><span class="line"><span class="string">&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>æƒ³äº†è§£æ›´å¤šå‚è€ƒ<a href="https://yaml.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">ruamel.yamlæ–‡æ¡£</a></p>
<p><del>å…¶å®åªæœ‰ä¸€ç‚¹é…ç½®ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡æ›´æ–¹ä¾¿â€¦ç¡¬ç¼–ç ä¹Ÿä¸æ˜¯ä¸å¯ä»¥æ¥å—emmm</del></p>
<p>ä¹Ÿç®—æ˜¯å­¦ä¹ äº†ä¸€ç§ä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹æ³•å§</p>
<p>å…ˆåœ¨<code>config.yaml</code>é‡Œé¢å†™å…¥</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.yaml</span></span><br><span class="line"><span class="attr">token:</span> <span class="string">ä½ è‡ªå·±çš„token</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤§è‡´æµç¨‹"><a href="#å¤§è‡´æµç¨‹" class="headerlink" title="å¤§è‡´æµç¨‹"></a>å¤§è‡´æµç¨‹</h3><h4 id="é¦–å…ˆè‡ªç„¶æ˜¯å¯¼å…¥å„ç§æ¨¡å—å•¦"><a href="#é¦–å…ˆè‡ªç„¶æ˜¯å¯¼å…¥å„ç§æ¨¡å—å•¦" class="headerlink" title="é¦–å…ˆè‡ªç„¶æ˜¯å¯¼å…¥å„ç§æ¨¡å—å•¦"></a>é¦–å…ˆè‡ªç„¶æ˜¯å¯¼å…¥å„ç§æ¨¡å—å•¦</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> telegram.ext <span class="keyword">import</span> Updater, CommandHandler</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> ruamel.yaml <span class="keyword">import</span> YAML</span><br><span class="line"><span class="keyword">import</span> psutil</span><br></pre></td></tr></table></figure>
<h4 id="Updaterå’ŒDispatcher"><a href="#Updaterå’ŒDispatcher" class="headerlink" title="Updaterå’ŒDispatcher"></a>Updaterå’ŒDispatcher</h4><p>æ¥ç€æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªç±»ç›¸äº’é…åˆæ¥å®Œæˆbotçš„è¿ä½œ</p>
<p>ä¸€ä¸ª<code>Updater</code>ï¼Œå¦ä¸€ä¸ª<code>Dispatcher</code></p>
<p>å‰è€…ä¸æ–­çš„æ¥å—æ¥è‡ªTelegramçš„ä¿¡æ¯å¹¶ä¸”å°†è¿™äº›ä¼ é€’åˆ°<code>Dispatcher</code>ï¼Œå½“ä½ åˆ›å»ºå¥½ä¸€ä¸ª<code>Updater</code>åä¼šè‡ªåŠ¨ä¹Ÿä¼šåˆ›å»ºå¥½åŒå±äºä¸€ä¸ªé˜Ÿåˆ—çš„<code>Dispatcher</code></p>
<p>åœ¨<code>Dispatcher</code>ä¸­æˆ‘ä»¬å¯ä»¥æ³¨å†Œå„ç§<code>handler</code>ï¼Œè¿™æ ·<code>Updater</code>ä¸­çš„æ•°æ®å°±ä¼šè¢«<code>handler</code>æ‰€å¤„ç†ï¼Œå¹¶ä¸”å°†å¤„ç†åçš„ä¿¡æ¯ä¼ é€’ç»™ä½ æ‰€æŒ‡å®šçš„å›è°ƒå‡½æ•°ä¸­å»</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¿™æ ·å°±å…ˆè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„<code>token</code>ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°ä¸Šä½¿ç”¨ä»£ç†ï¼Œåˆ›å»ºå¥½<code>Updater</code>å’Œ<code>Dispatcher</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="comment"># è¯»å–config.yamlé…ç½®æ–‡ä»¶</span></span><br><span class="line">yaml = YAML()</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'config.yaml'</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    config = yaml.load(f)</span><br><span class="line"></span><br><span class="line">TOKEN = config[<span class="string">'token'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°ä½¿ç”¨httpä»£ç†,å›½å¤–æœåŠ¡å™¨å¯ä»¥ä¸ç”¨è®¾ç½®</span></span><br><span class="line">REQUEST_KWARGS = &#123;</span><br><span class="line">    <span class="string">'proxy_url'</span>: <span class="string">'http://127.0.0.1:1087'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updater = Updater(TOKEN, request_kwargs=REQUEST_KWARGS)</span><br><span class="line">dispatcher = updater.dispatcher</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†çŸ¥é“åœ¨æ­¤è¿è¡Œä¸­å‡ºç°äº†ä»€ä¹ˆé”™è¯¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨<code>logging</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é”™è¯¯è°ƒè¯•</span></span><br><span class="line">logging.basicConfig(format=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>,</span><br><span class="line">                    level=logging.INFO)</span><br></pre></td></tr></table></figure>
<p>æ—¥å¸¸æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»<code>print</code>è½¬å‘<code>logging</code>æ¥å¤„ç†é”™è¯¯ä¿¡æ¯ï¼Œ<a href="https://cuiqingcai.com/6080.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>å…·ä½“çš„ä»‹ç»äº†ä¸‹<code>logging</code></p>
<h4 id="ç¼–å†™å¹¶æ³¨å†Œå›è°ƒå‡½æ•°"><a href="#ç¼–å†™å¹¶æ³¨å†Œå›è°ƒå‡½æ•°" class="headerlink" title="ç¼–å†™å¹¶æ³¨å†Œå›è°ƒå‡½æ•°"></a>ç¼–å†™å¹¶æ³¨å†Œå›è°ƒå‡½æ•°</h4><p>æˆ‘ä»¬å…ˆæ¥ç®€å•å†™ä¸ªæ‰“æ‹›å‘¼çš„ï¼Œä¸ºäº†æµ‹è¯•ä»¥ä¸Šçš„æ“ä½œæ˜¯å¦æ— è¯¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(bot, update)</span>:</span></span><br><span class="line">    bot.send_message(chat_id=update.message.chat_id, text=<span class="string">"I'm a bot"</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªbotç±»å‹å°±æ˜¯<code>telegram.Bot</code>ï¼Œé‡Œé¢çš„å„ç§å‡½æ•°å‚è§<a href="https://python-telegram-bot.readthedocs.io/en/latest/telegram.bot.html?highlight=end_message#" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>
<p>æœ‰å…³send_messageè¿˜æ˜¯çœ‹<a href="https://core.telegram.org/bots/api#sendmessage" target="_blank" rel="noopener">æ–‡æ¡£</a>å»å§</p>
<p>æ³¨å†Œä¸ª<code>handler</code>å°†<code>start</code>è®¾ä¸ºå›è°ƒå‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start_handler = CommandHandler(<span class="string">'start'</span>, start)</span><br><span class="line">dispatcher.add_handler(start_handler)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å†™å°±ä»£è¡¨å½“å‘æœºå™¨äººå‘é€<code>/start</code>å¼å°±ä¼šè°ƒç”¨startå‡½æ•°äº†</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦æœ‰å‘½ä»¤å‚æ•°æ€ä¹ˆåŠå‘¢ï¼Œå¯ä»¥ä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatcher.add_handler(CommandHandler(<span class="string">'start'</span>, start,pass_args=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<p><code>start</code>å‡½æ•°ä¹Ÿéœ€è¦æ·»åŠ ä¸ª<code>agrs</code>å‚æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(bot, update, args)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> args:</span><br><span class="line">        bot.send_message(chat_id=update.message.chat_id, text=<span class="string">"Hi &#123;&#125;, I'm a bot"</span>.format(args[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bot.send_message(chat_id=update.message.chat_id, text=<span class="string">"Hi , I'm a bot"</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸€åˆ‡éƒ½å‡†å¤‡å¥½åæœ€åä¸€è¡Œç”¨æ¥å¯åŠ¨bot</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updater.start_polling()</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å½“æˆ‘ä»¬ä½¿ç”¨<code>/start ratdis</code>æ—¶å°±ä¼šå›å¤<code>Hi ratdis, I&#39;m a bot</code>å•¦</p>
<h4 id="æ¥å¼ å˜´ï¼Œåƒä¸‹è¿™é¢—è¯­æ³•ç³–å§-è£…é¥°å™¨"><a href="#æ¥å¼ å˜´ï¼Œåƒä¸‹è¿™é¢—è¯­æ³•ç³–å§-è£…é¥°å™¨" class="headerlink" title="æ¥å¼ å˜´ï¼Œåƒä¸‹è¿™é¢—è¯­æ³•ç³–å§(è£…é¥°å™¨)"></a>æ¥å¼ å˜´ï¼Œåƒä¸‹è¿™é¢—è¯­æ³•ç³–å§(è£…é¥°å™¨)</h4><p>æ¯æ¬¡éƒ½è¦å…ˆåˆ›å»ºä¸ªhandlerå†add_handler</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¥ä¼˜åŒ–ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬ç”¨ä¸ªè£…é¥°å™¨æ¥é¿å…æ¯ä¸ªå‘½ä»¤éƒ½éœ€è¦æ‰‹åŠ¨æ³¨å†Œ</span></span><br><span class="line"><span class="comment"># é»˜è®¤ä¸æ¥å—å‘½ä»¤å‚æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">command</span><span class="params">(handler, cmd, pass_args=False, **kw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorater</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kw)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pass_args:</span><br><span class="line">            func_hander = handler(cmd, func, pass_args=<span class="literal">True</span>, **kw)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            func_hander = handler(cmd, func, **kw)</span><br><span class="line">        dispatcher.add_handler(func_hander)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorater</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬åªè¦åœ¨<code>start</code>å‡½æ•°ä¹‹å‰åŠ ä¸€è¡Œå°±å®Œæˆäº†æ³¨å†Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@command(CommandHandler, 'start', pass_args=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(bot, update, args)</span>:</span></span><br><span class="line">    ......</span><br></pre></td></tr></table></figure>
<p>ä¸€ç¯‡ä¸é”™çš„è£…é¥°å™¨ä»‹ç»<a href="https://foofish.net/python-decorator.html" target="_blank" rel="noopener">æ–‡ç« </a></p>
<h4 id="ä½¿ç”¨psutilè·å–æœåŠ¡å™¨è¿è¡Œä¿¡æ¯"><a href="#ä½¿ç”¨psutilè·å–æœåŠ¡å™¨è¿è¡Œä¿¡æ¯" class="headerlink" title="ä½¿ç”¨psutilè·å–æœåŠ¡å™¨è¿è¡Œä¿¡æ¯"></a>ä½¿ç”¨psutilè·å–æœåŠ¡å™¨è¿è¡Œä¿¡æ¯</h4><p>è¿™é‡Œæˆ‘ä»¬å°±ä»¥è·å–CPUåˆ©ç”¨ç‡ä¸ºä¾‹å§</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†<code>config.yaml</code>ä¸­<code>cpu_check_times</code>å’Œ<code>cpu_check_interval</code></p>
<p>æ‰€ä»¥å…ˆå°†<code>config.yaml</code>æ”¹æˆ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">token:</span> <span class="string">ä½ è‡ªå·±çš„token</span></span><br><span class="line"><span class="attr">cpu:</span></span><br><span class="line">  <span class="comment"># æ£€æµ‹CPUåˆ©ç”¨ç‡çš„æ¬¡æ•°</span></span><br><span class="line"><span class="attr">  cpu_check_times:</span> <span class="number">5</span></span><br><span class="line">  <span class="comment"># æ£€æµ‹CPUåˆ©ç”¨ç‡çš„é—´éš”(å•ä½ä¸ºç§’)</span></span><br><span class="line"><span class="attr">  cpu_check_interval:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><code>server</code>å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@command(CommandHandler, 'server')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">(bot, update)</span>:</span></span><br><span class="line">    <span class="comment"># æ£€æµ‹CPUåˆ©ç”¨ç‡çš„æ¬¡æ•°</span></span><br><span class="line">    CPU_CHECK_TIMES = config[<span class="string">'cpu'</span>][<span class="string">'cpu_check_times'</span>]</span><br><span class="line">    <span class="comment"># æ£€æµ‹CPUåˆ©ç”¨ç‡çš„é—´éš”(å•ä½ä¸ºç§’)</span></span><br><span class="line">    CPU_CHECK_INTERVAL = config[<span class="string">'cpu'</span>][<span class="string">'cpu_check_interval'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”¨æ¥ä¿å­˜æ¯æ¬¡æ£€æµ‹CPUåˆ©ç”¨ç‡çš„ç»“æœ</span></span><br><span class="line">    cpu_check_list = [<span class="number">0</span>] * psutil.cpu_count()</span><br><span class="line">    result = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> CPU_CHECK_TIMES:</span><br><span class="line">        <span class="comment"># æ£€æµ‹é€»è¾‘CPUçš„å ç”¨ç‡,å°†ç»“æœå…ƒç´ ç›¸åŠ åˆ°cpu_check_listä¸­</span></span><br><span class="line">        cpu_check_list = [a + b <span class="keyword">for</span> a, b <span class="keyword">in</span></span><br><span class="line">                          zip(psutil.cpu_percent(interval=CPU_CHECK_INTERVAL, percpu=<span class="literal">True</span>), cpu_check_list)]</span><br><span class="line">        CPU_CHECK_TIMES -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†ç›¸åŠ ç»“æœå–å¹³å‡å€¼å¹¶ä¸”è½¬åŒ–ä¸ºç™¾åˆ†æ¯”%æ ¼å¼</span></span><br><span class="line">    cpu_check_list = [<span class="string">'&#123;:.2f&#125;%'</span>.format(float(x / <span class="number">10</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> cpu_check_list]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> num, l <span class="keyword">in</span> enumerate(cpu_check_list):</span><br><span class="line">        result += <span class="string">"CPU&#123;&#125;å¹³å‡å ç”¨&#123;&#125;\n"</span>.format(num + <span class="number">1</span>, l)</span><br><span class="line"></span><br><span class="line">    bot.send_message(chat_id=update.message.chat_id, text=result)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬è¾“å…¥<code>/server</code>æ—¶å°±ä¼šå›å¤ç±»ä¼¼äºè¿™æ ·çš„</p>
<blockquote>
<p>CPU1å¹³å‡å ç”¨22.02%<br>CPU2å¹³å‡å ç”¨11.65%<br>CPU3å¹³å‡å ç”¨19.95%<br>CPU4å¹³å‡å ç”¨11.09%</p>
</blockquote>
<p>å½“ç„¶psutilè¿˜æä¾›äº†å¾ˆå¤šå¥½ç”¨çš„å‡½æ•°æ¥è·å–å„ç§ä¸ªæ ·çš„æœåŠ¡å™¨è¿è¡Œä¿¡æ¯ï¼Œ<a href="https://psutil.readthedocs.io/en/latest/" target="_blank" rel="noopener">psutilæ–‡æ¡£</a></p>
<h2 id="æœ¬åœ°ä¸Šçº¿åˆ°æœåŠ¡å™¨"><a href="#æœ¬åœ°ä¸Šçº¿åˆ°æœåŠ¡å™¨" class="headerlink" title="æœ¬åœ°ä¸Šçº¿åˆ°æœåŠ¡å™¨"></a>æœ¬åœ°ä¸Šçº¿åˆ°æœåŠ¡å™¨</h2><p>å–æ¶ˆä»£ç†(å›½å¤–æœåŠ¡å™¨)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°ä½¿ç”¨httpä»£ç†</span></span><br><span class="line"><span class="comment">#REQUEST_KWARGS = &#123;</span></span><br><span class="line"><span class="comment">#    'proxy_url': 'http://127.0.0.1:1087',</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#updater = Updater(TOKEN, request_kwargs=REQUEST_KWARGS)</span></span><br><span class="line">updater = Updater(TOKEN)</span><br></pre></td></tr></table></figure>
<p>ç”±äºæˆ‘ä»¬ä¸€ç›´éƒ½æ˜¯åå°è¿è¡Œï¼Œæ‰€ä»¥éœ€è¦å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°åˆ°logæ–‡ä»¶ä¸­å»ï¼Œä¿®æ”¹ä¸€ä¸‹loggingçš„ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  é”™è¯¯è°ƒè¯•</span></span><br><span class="line">logging.basicConfig(level=logging.INFO,</span><br><span class="line">                    filename=<span class="string">'TGbot.log'</span>,</span><br><span class="line">                    datefmt=<span class="string">'%Y/%m/%d %H:%M:%S'</span>,</span><br><span class="line">                    format=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(lineno)d - %(module)s - %(message)s'</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"><span class="comment"># logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',</span></span><br><span class="line"><span class="comment">#                     level=logging.INFO)</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å‡ºé”™ä¿¡æ¯å°±å¯ä»¥å»<code>TGbot.log</code>ä¸­å»çœ‹äº†</p>
<p>æœ€åä½¿ç”¨<code>nohup</code>ä¸€ç›´åœ¨åå°è¿è¡Œå°±å¥½å•¦</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup python3 main.py</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡ç®€å•çš„å†™äº†ä¸€ç‚¹å…³äºbotçš„ä¸œè¥¿ï¼Œè¿˜æœ‰å¾ˆå¤šç‰¹æ€§éƒ½æ²¡æœ‰æ€ä¹ˆè¯´ï¼Œæƒ³è¿›ä¸€æ­¥äº†è§£çš„å®Œå…¨å¯ä»¥å»çœ‹æ–‡æ¡£</p>
<p>è¿™ä¸ªç›‘æ§botä¹Ÿæœ‰å¾ˆå¤§çš„è¿›æ­¥ç©ºé—´ï¼Œå¤§å®¶å®Œå…¨å¯ä»¥åšä¸ªå…¨é¢çš„æœåŠ¡å™¨ç›‘æ§Botå‡ºæ¥</p>
<p>åˆ©ç”¨å¥½botçš„æ–¹ä¾¿æ€§ï¼Œå¯ä»¥å¾ˆå¥½çš„ç®¡ç†æœåŠ¡å™¨ï¼Œç”šè‡³æ˜¯æ¨é€å„ç±»æ¶ˆæ¯ï¼Œæ¨å‡ºä»˜è´¹åŠŸèƒ½ä¹‹ç±»çš„</p>
<h2 id="æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆæ‰“ç®—"><a href="#æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆæ‰“ç®—" class="headerlink" title="æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆæ‰“ç®—"></a>æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆæ‰“ç®—</h2><p>åº”è¯¥ä¼šæœ‰ä¸€æ®µè¾ƒé•¿çš„æ—¶é—´ä¸æ›´æ–°åšæ–‡äº†ï¼Œå¥½å¥½åˆ©ç”¨ä¸‹å‡æœŸå†™ç‚¹å°ç©æ„ï¼Œå—¯ï¼Œå°±è¿™æ ·å§</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-01-19</span><i class="fa fa-comment-o"></i><a href="/2019/01/19/creat-a-telegram-bot-with-python/#comments">Comments</a><i class="fa fa-tag"></i><a class="tag" href="/categories/program/" title="program">program </a><a class="tag" href="/tags/python/" title="python">python </a><a class="tag" href="/tags/telegram/" title="telegram">telegram </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://ratdis.github.io/2019/01/19/creat-a-telegram-bot-with-python/,å¢¨æŸ“çš„æ¨±èŠ±ğŸŒ¸,ç”¨Pythonå†™ä¸ªå°Bot,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/03/01/view-of-homework/" title="è®ºä½œä¸š">prev_post</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/12/18/algorithm-note-1/" title="ç®—æ³•ç¬”è®° å£¹">next_post</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'ratdis';
var disqus_identifier = '2019/01/19/creat-a-telegram-bot-with-python/';
var disqus_title = 'ç”¨Pythonå†™ä¸ªå°Bot';
var disqus_url = 'https://ratdis.github.io/2019/01/19/creat-a-telegram-bot-with-python/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>