<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="ratdis,ratdis1@gmail.com"><title>Python虚拟环境大杂烩 · 墨染的樱花🌸</title><meta name="description" content="写在前面距离上篇博客差了半年，很惭愧，因为促使自己写博客的动力之一就是接触了新东西，想记录下来，这大半年实在不太在状态，写了几篇文章发布后又删除了，好在最近感觉好了不少，继续吧
这个学期开始明显感觉校内网限速严重了许多，时不时还断连需要重新认证一下，体验很不好，尤其是用Pipenv安装一些包的时候，"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title><a href="/">墨染的樱花🌸</a></h3><div class="description"><p>成就今日 启迪未来</p></div></div></div><ul class="social-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Python虚拟环境大杂烩</a></h3></div><div class="post-content"><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>距离上篇博客差了半年，很惭愧，因为促使自己写博客的动力之一就是接触了新东西，想记录下来，这大半年实在不太在状态，写了几篇文章发布后又删除了，好在最近感觉好了不少，继续吧</p>
<p>这个学期开始明显感觉校内网限速严重了许多，时不时还断连需要重新认证一下，体验很不好，尤其是用<code>Pipenv</code>安装一些包的时候，尽管知道安装慢很大一部分是网络的问题，但当我看到<code>Pipenv</code>安装报错时，也渐渐对<code>Pipenv</code>起了一些疑虑，有时当我创建一个新的虚拟环境需要很长时间，有时候又Locking很久……，那颗折腾的心又躁动了起来。</p>
<h3 id="为什么需要虚拟环境"><a href="#为什么需要虚拟环境" class="headerlink" title="为什么需要虚拟环境"></a>为什么需要虚拟环境</h3><p>防止各种项目冲突顺便方便的导出所有依赖，简单的例子就是A项目中需要的是<code>Django1.0</code>，而B项目中需要的是<code>Django2.0</code>，为了防止来回卸载安装，所以我们使用虚拟环境分别配置单独的运行环境</p>
<h3 id="虚拟环境大杂烩"><a href="#虚拟环境大杂烩" class="headerlink" title="虚拟环境大杂烩"></a>虚拟环境大杂烩</h3><p>光是Pycharm所支持的就有 <code>virtualenv</code> <code>Conda</code> <code>Pipenv</code>等等</p>
<p>以及看大佬推荐的<code>Poetry</code> <code>Conda</code></p>
<p>最后还是选择了顺手的 <code>Hatch</code></p>
<p>看似繁荣的下面却反映出<code>Pyhton</code>社区的混乱……(叹气)</p>
<h3 id="选择哪种虚拟环境工具好"><a href="#选择哪种虚拟环境工具好" class="headerlink" title="选择哪种虚拟环境工具好"></a>选择哪种虚拟环境工具好</h3><p>先给出目前的个人结论：用回 <code>virtualenv</code>/<code>venv</code> 和 <code>pip</code>不一定是最方便的，但是至少更可靠</p>
<p>之前我一直都是用的<code>Pipenv</code>，说实在的除了偶尔<code>Creating</code>&amp;<code>Locking</code>慢了点，并没有遇到什么大问题，但当我看到 <a href="https://zhuanlan.zhihu.com/p/80478490" target="_blank" rel="noopener">不要用 Pipenv</a> 改变了 ‘我用着舒服你那问题我没遇见就接着用下去’ 的想法，其中最让我不能接受的就是打着官方暧昧关系进行宣传以及快一年没有新的 <code>releases</code> </p>
<p>既然已经有了换的心思，满怀希望的去尝试大佬推荐的 <code>Poetry</code> ，嗯官网界面很对我口味，结果正当我安装好初始化时现实又给我来了一巴掌</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">→ poetry init</span><br><span class="line"></span><br><span class="line">This command will guide you through creating your pyproject.toml config.</span><br><span class="line"></span><br><span class="line">[UnicodeDecodeError]</span><br><span class="line">'ascii' codec can't decode byte 0xe8 in position 0: ordinal not in range(128</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>溜了溜了，连最基础的路径下创建文件都能整一个编码错误的项目我是更不敢用了</p>
<p>还是老办法把</p>
<h3 id="重回-virtualenv-和-pip-时代"><a href="#重回-virtualenv-和-pip-时代" class="headerlink" title="重回 virtualenv 和 pip 时代"></a>重回 virtualenv 和 pip 时代</h3><p>这里我还用到了<code>virtualenvwrapper</code>这个工具来简化<code>virtualenv</code>的操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv virtualenvwrapper</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 环境配置</span><br><span class="line"><span class="meta">#</span> 查看 virtualenvwrapper.sh 路径</span><br><span class="line"><span class="meta">$</span> which virtualenvwrapper.sh</span><br><span class="line">/usr/local/bin/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 配置环境变量 (以后创建的环境目录都集中放在 $WORKON_HOME 目录下管理了)</span><br><span class="line"><span class="meta">#</span> 配置文件位置: ~/.bashrc (bash) 或 ~/.zshrc (zsh) (Linux/macOS（win自行搜索）)</span><br><span class="line">export WORKON_HOME=$HOME/.virtualenvs</span><br><span class="line">source /usr/local/bin/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 简化命令 ~/.zshrc (zsh)</span><br><span class="line"><span class="meta">#</span> which python | python3 得到-p后的参数值</span><br><span class="line">alias mkv3='mkvirtualenv -p /usr/local/bin/python3'</span><br><span class="line">alias mkv2='mkvirtualenv -p /usr/local/bin/python'</span><br><span class="line">alias lsv='lsvirtualenv'</span><br><span class="line">alias rmv='rmvirtualenv'</span><br><span class="line">alias shv='showvirtualenv'</span><br><span class="line">alias dev='deactivate'</span><br></pre></td></tr></table></figure>
<p>常用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> workon  进入|切换 环境</span><br><span class="line"><span class="meta">$</span> workon ENVNAME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> mkvirtualenv 创建环境</span><br><span class="line"><span class="meta">$</span> mkvirtualenv ENVNAME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> lsvirtualenv 展示环境列表</span><br><span class="line"><span class="meta">$</span> lsvirtualenv [-b] [-l] [-h]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> rmvirtualenv 删除环境</span><br><span class="line"><span class="meta">$</span> rmvirtualenv ENVNAME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> cpvirtualenv 复制环境</span><br><span class="line"><span class="meta">$</span> cpvirtualenv ENVNAME [TARGETENVNAME]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> allvirtualenv 所有环境运行命令 (比如安装包)</span><br><span class="line"><span class="meta">$</span> allvirtualenv command with arguments</span><br><span class="line"><span class="meta">$</span> allvirtualenv pip install -U pip</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> deactivate 退出当前环境</span><br><span class="line"><span class="meta">$</span> deactivate</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> mkproject  创建项目</span><br><span class="line"><span class="meta">$</span> mkproject [-f|--force] [-t template] [virtualenv_options] ENVNAME</span><br></pre></td></tr></table></figure>
<h3 id="发展中的Hatch-不支持Python2"><a href="#发展中的Hatch-不支持Python2" class="headerlink" title="发展中的Hatch(不支持Python2)"></a>发展中的Hatch(不支持Python2)</h3><p>就在我准备收尾时，突然发现了 <a href="https://github.com/ofek/hatch" target="_blank" rel="noopener">Hatch</a> 这个项目，基于virtualenv</p>
<p>简单安装使用下来发现意外的很舒服，具体安装步骤见项目主页，这里简单回顾提及下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 安装virtualenv和Hatch</span><br><span class="line">pip3 install virtualenv hatch</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 如果重启后hatch用不了那么可能是你没有配置好python的PATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 配置环境变量(Linux/macOS（win自行搜索）)</span><br><span class="line"><span class="meta">#</span> 配置文件位置: ~/.bashrc (bash) 或 ~/.zshrc (zsh)</span><br><span class="line"><span class="meta">&gt;</span> which python3</span><br><span class="line">	/usr/local/Cellar/python/3.7.4/bin</span><br><span class="line"><span class="meta">&gt;</span> export PATH=/usr/local/Cellar/python/3.7.4/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>常用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 列出所有的虚拟环境（~/.virtualenvs）</span><br><span class="line">hatch env -l</span><br><span class="line"><span class="meta">#</span> 创建虚拟环境</span><br><span class="line">hatch env envname</span><br><span class="line"><span class="meta">#</span> 进入虚拟环境</span><br><span class="line">hatch shell envname</span><br><span class="line"><span class="meta">#</span> 删除虚拟环境</span><br><span class="line">hatch shed -e envname</span><br><span class="line"><span class="meta">#</span> 退出虚拟环境</span><br><span class="line">exit</span><br><span class="line"><span class="meta">#</span> 列出所有以保存的pypath</span><br><span class="line">hatch pypath -l</span><br><span class="line"><span class="meta">#</span> 添加一个指向/usr/bin/python名字为py2的pypath</span><br><span class="line">hatch pypath py2 /usr/bin/python</span><br><span class="line"><span class="meta">#</span> 删除一个pypath</span><br><span class="line">hatch shed -p py2</span><br><span class="line"><span class="meta">#</span> 使用指定的pypath(这里是py2)作为虚拟环境的解释器</span><br><span class="line">hatch env -py py2 old</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 简化命令 ~/.zshrc (zsh)</span><br><span class="line">alias inv='hatch shell'</span><br><span class="line">alias lsv='hatch env -l'</span><br><span class="line">alias rmv='hatch shed -e'</span><br></pre></td></tr></table></figure>
<p>目前上面这些功能其实和<code>virtualenv</code>差不多，但是项目主页上的TODO中有一行写到<code>python</code> - installs the desired version of Python. will work on each platform，这代表以后版本更新后也可以自由的像<code>Conda</code>那样创建虚拟环境的时候直接指定特定的<code>Python</code>版本（值得一提的是：之前我也尝试去用了下<code>Conda</code>来管理，但是他会和<code>pip</code>有一定冲突，而且如果用<code>Conda install</code>会有很多包找不到，在虚拟环境下安装<code>pip</code>又会多出几个额外的依赖，所以放弃了）</p>
<p>期待<code>Hatch</code>后续的更新，毕竟我切换<code>Python</code>版本还是用的少的</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-11-29</span><i class="fa fa-comment-o"></i><a href="/2019/11/29/Python-virtual-environment-hodgepodge/#comments">Comments</a><i class="fa fa-tag"></i><a class="tag" href="/categories/note/" title="note">note </a><a class="tag" href="/tags/python/" title="python">python </a><a class="tag" href="/tags/dev/" title="dev">dev </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://ratdis.github.io/2019/11/29/Python-virtual-environment-hodgepodge/,墨染的樱花🌸,Python虚拟环境大杂烩,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/02/22/use-Flask-SQLAlchemy-database management/" title="使用Flask-SQLAlchemy管理数据库">prev_post</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/05/18/Django-develop-note/" title="Django开发中的笔记">next_post</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'ratdis';
var disqus_identifier = '2019/11/29/Python-virtual-environment-hodgepodge/';
var disqus_title = 'Python虚拟环境大杂烩';
var disqus_url = 'https://ratdis.github.io/2019/11/29/Python-virtual-environment-hodgepodge/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/baidu-statistical.js"></script></body></html>